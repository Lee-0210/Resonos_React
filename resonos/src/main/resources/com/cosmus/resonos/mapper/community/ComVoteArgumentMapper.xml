<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cosmus.resonos.mapper.community.ComVoteArgumentMapper">

  <select id="list" resultType="ComVoteArgument">
    SELECT * FROM com_vote_argument
  </select>

  <insert id="insert">
    INSERT INTO com_vote_argument (vote_id, content, arg_no)
    SELECT
      #{voteId},
      #{content},
      COALESCE(MAX(arg_no), 0) + 1
    FROM (
      SELECT * FROM com_vote_argument WHERE vote_id = #{voteId}
    ) AS temp
  </insert>


  <update id="update">
    UPDATE com_vote_argument
    <set>
      updated_at = now()
    </set>
    WHERE -- key 지정 필요
  </update>

  <delete id="delete">
    DELETE FROM com_vote_argument
    WHERE id = #{id}
  </delete>

  <!-- 항목 삭제 후 -->
  <!-- <update id="reorderArguments">
    UPDATE com_vote_argument
    <set>
      arg_no = arg_no - 1
    </set>
    WHERE vote_id = #{voteId}
      AND arg_no > #{argNo}
  </update> -->

  <update id="completeAll">
    UPDATE com_vote_argument SET -- 수정필드 없음
  </update>

  <delete id="deleteAll">
    DELETE FROM com_vote_argument
  </delete>
</mapper>